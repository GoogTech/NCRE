/*
 * @Author: HuangYuhui 
 * @Date: 2019-02-13 13:56:35 
 * @Last Modified by: HuangYuhui
 * @Last Modified time: 2019-02-13 16:53:37
 */

设计与应用题

1-在某数据库中,相关表的建表语句如下 : 
CREATE TABLE T1
(
    a1 INT PRIMARY KEY,
    a2 INT,
    a3 INT FOREIGN KEY REFERENCES T2(a3);
);
CREATE TABLE T2
(
    a3 INT PRIMARY KEY,
    a4 INT,
    a5 INT FOREIGN KEY REFERENCES T2(a3)
);
CREATE TABLE T3
(
    a1 INT,
    a3 INT,
    a6 INT,
    PRIMARY KEY(a1,a3),
    a1 FOREIGN KEY REFERENCES T1(a1),
    a3 FOREIGN KEY REFERENCES T2(a3)
);

问 : 请画出相应的ER图,使得可以从该ER图推导上述表定义,其中实体和联系的名称可以自定,实体的主码属性请使用下划线标明.

    ------ 解题思路 ------
    ER图向关系模式转换涉及到两方面 : 
    (1)-实体的转换 : 在从ER图转换为关系模式时,一个实体就转换为一个关系模式,实体的属性就是关系的属性,
        实体的键就是关系的主键.
    (2)-实体间联系的转换 : 实体间存在三种联系,即 1:1, 1:m, m:n 联系.
        1 : 1
            Method1-联系转化为独立的关系模式.模式的属性有联系本身的属性及两个实体的键构成,主键由两个实体中的任意一个键构成.
            Method2-联系与一端的实体的关系模式合并,既将联系的属性加入到实体的关系模式内,主键不变.
        1 : m
            Method1-联系转换为独立的关系模式.模式的属性由联系本身的属性及两个实体的键构成.主键由m端实体的键组成.
            Method2-与m端的实体的关系模式合并,既将联系的属性加入到实体的关系模式中内,主键不变.
        m : n
            多对多联系转换成新的独立的模式时,模式的属性由联系本身的属性及两个实体的键构成,主键是由两端实体的键组合而成.

        思路: 该题是从'关系模式'来推断ER图,因此解题的思路是对'ER'向关系模式转换做反向转换.
        根据规则C可以推断T3实体多对多关系.(a1和a3是实体的主码,a6是联系的属性).    
        根据规则B可以推断T1,T2是 1:m 关系.(a3和a5是外码,且a3和a5的值相同.a2,a4是联系T1,T2的属性,a2也可以是实体1的属性)


    ------ 参考答案 ------ 
    详情见 : question-0901.png





2-s设在SQL Server 2008某数据库中有商品表和销售表,两个表的定义如下 :
CREATE TABLE 商品表
(
    商品号 CHAR(10) PRIMARY KEY,
    商品名 VARCHAR(40),
    类别 VARCHAR(20),
    进货单价 INT
);
CREATE TABLE 销售表
(
    商品号 CHAR(10) REFERENCES 商品表(商品号)
    销售时间 DATETIME
    销售数量 INT,
    销售单价 INT,
    PRIMARY KEY(商品号,销售时间)
);

现要创建一个存储过程 : 查询指定类别的每种商品当年累计销售总金额.请补全下列代码.
CREATE PROC p_TotalSales @lb VARCHAR(20)    
AS
    SELECT 商品名,(SELECT ______ FROM 销售表 t1 WHERE ______ AND YEAR(销售时间) = year(______)) AS 当年销售总数量
        FROM 商品表 t2 WHERE ______

    ------ 解题思路 ------
    整个'SELECT'语句的含义是 : 根据'WHERE'子句的条件表达式,从'FROM'子句指定的基本表或视图中找出满足条件的元组.
    再按SELECT子句中的目标列的表达式,选出元组中的属性值形成结果集.

    ------ 参考答案 ------
    CREATE PROC p_TotalSales @lb VARCHAR(20)    
    AS
        SELECT 商品名,(SELECT SUM(销售单价*销售数量) FROM 销售表 t1 WHERE t1.商品号=t2.商品号 AND YEAR(销售时间) = year(t1.销售时间)) AS 当年销售总金额
            FROM 商品表 t2 WHERE t2.类别 = @lb      /* Attention : @lb VARCHAR(20) */





3-设某超市经营管理系统使用SQL Server 2008数据库管理系统,为了保证数据库可靠运行,数据库管理员设置了每天夜间对数据库一次全备份,
  备份的数据保留两个月的备份策略.上线运行一年后,SQL Server 数据库中数据已经达到了近200GB,每天夜间要运行3个小时才能将数据库
  进行一次全备份,影响了夜间统计等业务正常运行,同时,备份空间也非常的紧张.请解释出现此现象的原因,并提出优化的方法.

    ------ 解题思路 ------
    结合下述备份方式的优点以缩短备份时间,节约备份空间,提高备份的效率.
    (1)完整性数据库备份(Full Backup)
    (2)差异备份(Differential Backup)
    (3)日志备份(Log Backup)

    ------ 参考答案 ------
    产生此现象的原因是系统采用了全备份策略,随着业务的开展,需要备份数量量逐渐增大,备份时间越来越长,
    占用了系统的空间资源,从而影响了其它业务,解决的方法就是采用: 全备份+差异备份+日志备份组合的策略
    备份数据库.
    全备份和+差异备份+日志备份是指在全备份中加一些差异备份,比如: 每周日0:00进行一次全备份,然后每天
    0:00点进行一次差异备份,然后再在两次差异备份之间增加一些日志备份.这种策略的优点是: 备份和恢复的
    速度都比较快,而且当系统出现故障时,丢失的数据也很少.

    备份示意图见 : question-0903.png
    